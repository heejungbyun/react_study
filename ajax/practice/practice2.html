<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Practice</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <style type="text/css">
    </style>
    <script src="//code.jquery.com/jquery-1.12.4.min.js"></script>
</head>
<body>
    <div class="panel panel-default">
        <div class="panel panel-body cate">
        </div>
    </div>
    <div class="panel-body result">

    </div>
    <script>
        $.ajax({
            'type':'get',
            'url':'data/data_selector.json',
            'dataType':'json',
            'cache':false,
            success:function(json){
                //1depth length
                var dataLength = json.tree.length;
                //success 됬을시 셀렉트 생성
                $(".cate").html('<select class="slc1"/>')
                $('.slc1').html('<option>선택하세요</option>')
                //data tree의 1depth의 개수만큼 셀렉트에 옵션을 붙인다.
                for(var i=0;i<dataLength;i++){
                    $('.slc1').append('<option>'+json.tree[i].field+'</option>');
                }
                //셀렉트를 선택하면 다음 셀렉트 박스가 생성된다.


                $(document).on('change','.slc1',function() {
                    //*//
                    // 첫번째 셀렉트의 index가 저장될 변수
                    var SelecIdx = $(this).find('option:selected').index();
                    var selecVal = $(this).find('option:selected').text();
                     $('.result1,.result2,.result3,.slc2,.slc3').detach();
                     //선택된 자식이 0 이 아닐때
                     if(SelecIdx != 0){
                         $('.cate').append('<select class="slc2"/>');
                         $('.slc2').html('<option>선택하세요</option>');
                         $('.result').append('<span class="result1" />');
                         $('.result1').html(selecVal+" &gt; ")
                         makeSlc();
                     }
                    function makeSlc(){
                        var cate2depth = json.tree[SelecIdx-1].tree.length;
                        for(var i = 0;i<cate2depth;i++){
                            $('.slc2').append('<option>'+json.tree[SelecIdx-1].tree[i].field+'</option>')
                        }
                    }

                    //두번째 셀렉트의 이벤트
                    $('.slc2').on('change',function(){
                        // 두번째 셀렉트의 index가 저장될 변수
                        var SelecIdx2 = $(this).find('option:selected').index();
                        var selecVal = $(this).find('option:selected').text();
                        $('.result2,.result3,.slc3').detach()

                        if(SelecIdx2 !=0){
                            $('.cate').append('<select class="slc3"/>');
                            $('.slc3').html('<option>선택하세요</option>');
                            $('.result').append('<span class="result2" />');
                            $('.result2').html(selecVal+" &gt; ")
                            makeSlc()
                        }
                        function makeSlc(){
                            var cate3depth = json.tree[SelecIdx-1].tree[SelecIdx2-1].tree;
                            console.log(cate3depth)
                            for(var i = 0; i< cate3depth.length; i++){
                                $('.slc3').append('<option>'+json.tree[SelecIdx-1].tree[SelecIdx2-1].tree[i].field)
                                console.log(json.tree[SelecIdx-1].tree[SelecIdx2-1].tree[i].field)
                            }
                        }
                        //세번째 셀렉트의 이벤트
                        $('.slc3').on('change',function(){
                            console.log('으악')
                            var SelecIdx3 = $(this).find('option:selected').index();
                            var selecVal = $(this).find('option:selected').text();
                            $('.result3').detach();
                            if(SelecIdx3 !=0){
                                $('.result').append('<span class="result3" />');
                                $('.result3').html(selecVal)
                            }
                        })
                    });
                })

            },error:function(){
                console.log('안된다');
            }
        });
    </script>
</body>
</html>
