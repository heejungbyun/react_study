<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Practice</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <style type="text/css">
    </style>
    <script src="//code.jquery.com/jquery-1.12.4.min.js"></script>
</head>
<body>
    <div class="panel panel-default">
        <div class="panel panel-body cate">
			<select class="select"></select>
        </div>
    </div>
    <div class="panel-body result">

    </div>
    <script>
        $.ajax({
            'type':'get',
            'url':'data/data_selector.json',
            'dataType':'json',
            'cache':false,
            success:function(json){
				var data = json.tree;
				var selectComponent = {
					_select : null,
					_selectIdx : [],
					_initSelect : function(selector){
						this._select = $(selector);
						this._select.append('<option>선택하세요</선택하세요>');
						for(var i in data){
							this._select.append('<option>'+data[i].field+'</option')
						}
					},
					_stepSelect : function(){
						var selector = this._select;
						var selectIdx;
						var that = this;
						$(document).on('change',selector,function(){
							var idx = $(selector).index();
							// 1depth 이외의 모든 값을 초기화한다.
							$(selector).next().detach();
							//선택하세요 옵션때문에 -1을 빼고 저장한다.
							that._selectIdx[idx] = $(this).find('option:selected').index()-1;
							// 변수에도 저장한다.
							var selectIdx = that._selectIdx[idx];

							//selectIdx가 0이 아니고, data의 값도 0이 아니라면 2depth를 생성한다.
							if(selectIdx !=-1){
								//하위 트리가 없다면 select 자체를 생성하지 않는다.
								if(!(data[selectIdx].tree == 0)){
									$(selector).after('<select class="select_step2"><option>선택하세요</option></select>');
								}
								for(var i = 0; i <data[selectIdx].tree.length;i++){
									$('.select_step2').append('<option>'+data[selectIdx].tree[i].field+'</option>')
								}
							}
							//생성끝
						}).on('change','.select_step2',function(){
							var idx = $(this).index();

							$(this).next().detach();
							that._selectIdx[idx] = $(this).find('option:selected').index()-1;

							var selectIdx = that._selectIdx[idx];

							if(selectIdx !=-1){
								console.log(data[that._selectIdx[idx]].tree[selectIdx])
								// if(!(data[that._selectIdx[idx-1]].tree[selectIdx].field == 0)){
								// 	$(selector).after('<select class="select_step2"><option>선택하세요</option></select>');
								// }
							}
						})
					}
				}

				//Init
				selectComponent._initSelect('.select');
				selectComponent._stepSelect();
				//twoDepth


            },error:function(){
                console.log('안된다');
            }
        });
    </script>
</body>
</html>
